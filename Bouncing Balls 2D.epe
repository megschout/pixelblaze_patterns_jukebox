{
  "name": "Bouncing Balls 2D",
  "id": "k6H5xvKpbuChrEcLo",
  "sources": {
    "main": "/**\n * This pattern works with either a strip or rectangular matrix, and ideally with the sensor\n * expansion board. It works fine on both PBv2 and PBv3. It simulates a row of bouncing balls\n * that can be triggered by shaking the accelerometer.\n *\n * You will need to set the 'width' variable to the width of your matrix, or set it to 1 if\n * you are just using an LED strip.\n * \n * If you do not have the sensor expansion board, uncomment the \"init(i)\" at line 130. This\n * will cause the balls to \"rebounce\" automatically once they have come to rest, rather than\n * relying on the accelerometer.\n * \n * There are multiple parameters that can be configured using the slider controls:\n *   Gravity - how strong the force of gravity is on the balls.\n *   Motion Sensitivity - how much sudden movement is required for the balls to 'rebounce'.\n *   Show Rainbow - enables/disables a rainbow pattern underneath the balls.\n *   Randomness - how closely the balls stay in sync with each other.\n *\n * Pattern by @ChrisNZ, inspired by inspired by this project https://hackaday.io/project/177255-neopixel-led-skirt\n */\n\n// Set this to the width of your matrix\nvar width = 16\nvar height = pixelCount / width\n\n\n// Acceleration of gravity in m/s^2\nexport var gravity = -9.81\nexport function sliderGravity(v) {\n  gravity = -v * 29 - 1\n  resetAll()\n}\n\n// How sensitive the pattern is to movement from the accelerometer\nexport var motionThreshold = 0.03\nexport function sliderMotionSensitivity(v) {\n  motionThreshold = v * v * 0.07055 + 0.0195\n}\n\n// Whether or not to draw a rainbow pattern under the bouncing balls\nexport var rainbow = 1\nexport function sliderShowRainbow(v) {\n  rainbow = v >= 0.5\n}\n\n\nexport var randomness = 100\nexport function sliderRandomness(v) {\n  randomness = v * v * 500\n}\n\nfunction initGravity() {\n  impactVelocityStart = sqrt(-2 * gravity * startHeight)\n}\n\n// Get accelerometer info from the sensor expansion board - 3 element array with [x,y,z]\nexport var accelerometer\n\nvar debounce = 0\nvar prevAccel = array(3)\nvar diff = array(3)\n\nvar dampening = 0.9   // How much dampening to apply to each ball after it bounces\nvar startHeight = 1   // Starting height of the ball, in meters\nvar impactVelocityStart\n\n// Keep track of multiple balls, one per vertical strip\nvar ballHeight = array(width)            // Current height of each ball.\nvar impactVelocity = array(width)        // The current impact velocity of each ball. This decreases with each bounce.\nvar timeSinceLastBounce = array(width)   // How long since the last bounce. This helps calcuate the new height.\nvar startDelay = array(width)            // How long a delay before each ball starts bouncing. The 'Randomness' slider\n                                         // affects this.\n\n\nfunction resetAll() {\n  initGravity()\n  for (i = 0; i < width; i++) {\n    init(i)\n  }\n}\n\n// Reset a ball so it starts bouncing again\nfunction init(i) {\n  ballHeight[i] = 0\n  impactVelocity[i] = impactVelocityStart\n  timeSinceLastBounce[i] = 0\n  startDelay[i] = random(randomness)\n}\n\n\nresetAll()\n\nexport function beforeRender(delta) {\n  xa = accelerometer[0]\n  ya = accelerometer[1]\n  za = accelerometer[2]\n  diff[0] = abs(xa - prevAccel[0])\n  diff[1] = abs(ya - prevAccel[1])\n  diff[2] = abs(za - prevAccel[2])\n  totalAccel = sqrt(xa * xa + ya * ya + za * za)\n  \n  debounce = clamp(debounce + delta, 0, 2000) // Prevent overflow\n  \n  // Bounce all the balls if sensor board is shaken, no more than every second\n  if (debounce > 1000 && totalAccel > motionThreshold) {\n    debounce = 0\n    resetAll()\n  }\n  \n  for (i = 0; i < width; i++) {\n    // If this ball's startDelay hasn't expired, don't do anything yet\n    if (startDelay[i] > 0) {\n      startDelay[i] -= delta\n      continue\n    }\n  \n    timeSinceLastBounce[i] += delta\n    time = timeSinceLastBounce[i] / 1000\n    ballHeight[i] = 0.5 * gravity * time * time + impactVelocity[i] * time\n    \n    // Check if the ball has reached the bottom of the strip. If so, bounce it\n    if (ballHeight[i] < 0) {\n      ballHeight[i] = 0\n      impactVelocity[i] *= dampening\n      timeSinceLastBounce[i] = 0\n      \n      \n      // If the ball has (nearly) stopped moving, we can kick it back up to full bounce.\n      // This is useful if you don't have an accelerometer.\n      if (impactVelocity[i] < 1) {\n        // init(i)\n      }\n    }\n  }\n}\n\nexport function render2D(index, x, y) {\n  xPixel = floor(x * width)\n  yPixel = height - 1 - floor(y * height)\n  \n  yBall = floor(ballHeight[xPixel] * height)\n  \n  if (yPixel == yBall) {\n    rgb(1, 1, 1)\n  } else if (rainbow && yPixel < yBall) {\n    hsv((yBall - yPixel) / height + wave(x), 1, 1) \n  }\n}"
  },
  "preview": "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"
}